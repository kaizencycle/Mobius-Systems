name: Sentinel Validate
on:
  pull_request:
    paths:
      - 'sentinels/**'
      - 'docs/specs/**'
      - '.github/workflows/sentinel-validate.yml'
jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
      - name: Install ajv
        run: npm i -g ajv-cli@5
      - name: Validate sentinel manifests
        run: |
          for f in $(git ls-files 'sentinels/*/sentinel.yaml'); do
            echo "Validating $f"
            ajv validate -s docs/specs/sentinel.schema.json -d "$f"
          done
      - name: Optional repo checks (non-blocking)
        run: |
          npm i -g pnpm@9 || true
          pnpm install --frozen-lockfile || true
          pnpm -w lint || true
          pnpm -w type-check || true
          pnpm -w test -- --coverage || true
          pnpm -w integrity:report || true
